<!doctype html>
<html lang="en-us">
  <head>
    <title>Instalacion local CMS PHP // El rincon del admin</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Sergio Ibañez" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://sergioib.netlify.app/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Instalacion local CMS PHP"/>
<meta name="twitter:description" content="Instalación de un servidor LAMP Empezamos creando una instancia de vagrant basado en un box debian o ubuntu y una vez creado ejecutamos vagrant init en el directorio donde crearemos el vagrantfile.
Configuración del vagrantfile:
Vagrant.configure(&quot;2&quot;) do |config| config.vm.define :nodo1 do |nodo1| nodo1.vm.box = &quot;debian/buster64&quot; nodo1.vm.hostname = &quot;server&quot; nodo1.vm.network :private_network, type: &quot;dhcp&quot; end Una vez configurado el vagrantfile levantamos el escenario usando vagrant up y luego nos conectamos al servidor con vagrant ssh."/>

    <meta property="og:title" content="Instalacion local CMS PHP" />
<meta property="og:description" content="Instalación de un servidor LAMP Empezamos creando una instancia de vagrant basado en un box debian o ubuntu y una vez creado ejecutamos vagrant init en el directorio donde crearemos el vagrantfile.
Configuración del vagrantfile:
Vagrant.configure(&quot;2&quot;) do |config| config.vm.define :nodo1 do |nodo1| nodo1.vm.box = &quot;debian/buster64&quot; nodo1.vm.hostname = &quot;server&quot; nodo1.vm.network :private_network, type: &quot;dhcp&quot; end Una vez configurado el vagrantfile levantamos el escenario usando vagrant up y luego nos conectamos al servidor con vagrant ssh." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sergioib.netlify.app/posts/instalacion-local-cms-php/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-11T10:13:49&#43;01:00" />
<meta property="article:modified_time" content="2021-03-11T10:13:49&#43;01:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://sergioib.netlify.app/"><img class="app-header-avatar" src="/avatar.jpg" alt="Sergio Ibañez" /></a>
      <h1>El rincon del admin</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/categories/">Categories</a>
      </nav>
      <p>Blog de informatica dedicado a practicas realizadas en ASIR, a apuntes de administracion y variedades informaticas</p>
      <div class="app-header-social">
        
          <a href="https://github.com/sergioib94" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Instalacion local CMS PHP</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Mar 11, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          8 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <h3 id="instalación-de-un-servidor-lamp"><strong>Instalación de un servidor LAMP</strong></h3>
<p>Empezamos creando una instancia de vagrant basado en un box debian o ubuntu y una vez creado ejecutamos vagrant init en el directorio donde crearemos el vagrantfile.</p>
<p>Configuración del vagrantfile:</p>
<pre><code>Vagrant.configure(&quot;2&quot;) do |config|
config.vm.define :nodo1 do |nodo1|
    nodo1.vm.box = &quot;debian/buster64&quot;
    nodo1.vm.hostname = &quot;server&quot;
    nodo1.vm.network :private_network, type: &quot;dhcp&quot;
end
</code></pre><p>Una vez configurado el vagrantfile levantamos el escenario usando vagrant up y luego nos conectamos al servidor con vagrant ssh.</p>
<p>Lo primero que haremos en la maquina sera ejecutar un update y un upgrade. Después de el update y el upgrade, empezaremos a descargar la pila LAMP (apache, mariadb y php):</p>
<p>Apache:</p>
<pre><code>sudo apt install apache2
</code></pre><p>Mariadb:</p>
<pre><code>apt install mariadb-server mariadb-client
</code></pre><p>PHP:</p>
<pre><code>apt install php7.3
</code></pre><h3 id="instalación-de-drupal-en-el-servidor-local"><strong>Instalación de Drupal en el servidor local</strong></h3>
<ul>
<li>Configuraremos el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: <a href="http://www.nombrealumno-drupal.org">www.nombrealumno-drupal.org</a>.</li>
</ul>
<p>Configuración en el servidor en drupal.conf:</p>
<pre><code>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /srv/www/
    ServerName www.sergioib-drupal.org
    &lt;Directory /srv/www/drupal&gt;
        	Options Indexes FollowSymLinks
        	AllowOverride All
        	Require all granted
    &lt;/Directory&gt;
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre><p>Configuración en el cliente en etc/hosts:</p>
<pre><code>172.28.128.16   www.sergioib-drupal.org
</code></pre><ul>
<li>Creamos un usuario en la base de datos para trabajar con la base de datos donde se van a guardar los datos del CMS.</li>
</ul>
<pre><code>vagrant@server:~$ sudo mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 51
Server version: 10.3.25-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; create database drupalbd;
Query OK, 1 row affected (0.001 sec)

MariaDB [(none)]&gt; create user drupal;
Query OK, 0 rows affected (0.001 sec)
MariaDB [(none)]&gt; grant all on drupalbd.* to drupal identified by 'drupal';
Query OK, 0 rows affected (0.001 sec)
</code></pre><ul>
<li>Descargamos la versión que nos parezca más oportuna de Drupal y realiza la instalación.</li>
</ul>
<pre><code>wget https://www.drupal.org/download-latest/zip
</code></pre><p>Una vez instalado, abrimos en un navegador la url de nuestro sitio para seguir con la instalacion en 6 pasos:</p>
<p>El primer paso al elegir el idioma español, da error porque en la instalacion no se instalo la carpeta de idiomas, por lo que en el directorio /drupal/sites/default creamos el directorio /files/translations y en ese directorio translations descargamos el paquete del idioma español.</p>
<pre><code>wget https://ftp.drupal.org/files/translations/all/drupal/drupal-8.9.7.es.po
</code></pre><p>En el segundo paso elegimos el perfil que vamos a tener, en este caso uno estándar.</p>
<p>En el tercer paso hubo varios problemas con los requistos:</p>
<p>◦ Extensiones php
▪ Solucion → sudo apt instal php-gd php-xml</p>
<p>◦ Funcionalidad de bases de datos
▪ Solucion → sudo apt install php7.3-pdo php7.3-mysqli</p>
<p>◦ Problemas de permisos /sites/default/files
▪ Solución → sudo chmod a+w sites/default/files</p>
<p>◦ Archivo de configuración
▪ Solución:
• sudo cp sites/default/default.settings.php sites/default/settings.php
• sudo chmod a+w sites/default/settings.php</p>
<p>En el cuarto introducimos los datos de nuestra base de datos, nombre de la base, usuario que la va a usar y contraseña. Después instalamos el sitio y lo configuramos.</p>
<ul>
<li>Realizamos una configuración mínima de la aplicación (Cambia la plantilla, crea algún contenido, …)</li>
</ul>
<p>Apariencia → instalar nuevo tema → pegar enlace donde este el tema → buscarlo y descargarlo</p>
<p>Contenido → Añadir contenido → Elegir contenido a crear (en este caso un articulo) → Guardar los cambios</p>
<ul>
<li>Instalamos un módulo para añadir alguna funcionalidad a drupal.</li>
</ul>
<p>Ampliar → seleccionamos un modulo, en este caso el foro→ instalar, en mi caso como ejemplo instale el modulo forum.</p>
<p>Prueba de funcionamiento de Drupal 9 con las configuraciones ya realizadas:</p>
<h3 id="configuración-multimodo"><strong>Configuración multimodo</strong></h3>
<ul>
<li>Realizamos una copia de seguridad de la base de datos mysql:</li>
</ul>
<pre><code>mysqldump --user=drupal --password=drupal drupalbd &gt; copiadrupalbd.sql
</code></pre><ul>
<li>Creamos otra máquina con vagrant, conectada con una red interna a la anterior y configuramos un servidor de base de datos.</li>
</ul>
<p>Configuración de vagrantfile:</p>
<pre><code>Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.define :nodo1 do |nodo1|
    nodo1.vm.box = &quot;debian/buster64&quot;
    nodo1.vm.hostname = &quot;server&quot;
    nodo1.vm.network :public_network,:bridge=&gt;&quot;wlo1&quot;
    nodo1.vm.network :private_network, ip: &quot;192.168.100.10/24&quot;, virtualbox__intnet: &quot;Red_int&quot;
  end

  config.vm.define :nodo2 do |nodo2|
    nodo2.vm.box = &quot;debian/buster64&quot;
    nodo2.vm.hostname = &quot;server-bd&quot;
    nodo2.vm.network :private_network, ip: &quot;192.168.100.20/24&quot;, virtualbox__intnet: &quot;Red_int&quot;
  end
</code></pre><ul>
<li>Creamos un usuario en la base de datos para trabajar con la nueva base de datos.</li>
</ul>
<p>Instalamos mariadb igual que en la maquina anterior:</p>
<pre><code>sudo apt install mariadb-server mariadb-client
</code></pre><p>Y creamos un usuario igual que en la maquina anterior:</p>
<pre><code>vagrant@server-bd:~$ sudo mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 49
Server version: 10.3.25-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; create user drupal identified by drupal;
Query OK, 0 rows affected (0.001 sec)
</code></pre><ul>
<li>Restauramos la copia de seguridad en el nuevo servidor de base datos.</li>
</ul>
<pre><code>mysql -u drupal -pdrupal drupalbd &lt; copiadrupaldb.sql
</code></pre><ul>
<li>Desinstalamos el servidor de base de datos en el servidor principal.</li>
</ul>
<pre><code>sudo apt purge mariadb-*
</code></pre><ul>
<li>Realizamos los cambios de configuración necesario en drupal para que la página funcione.</li>
</ul>
<p>Configuración de settings.php</p>
<pre><code>$databases['default']['default'] = array (
'database' =&gt; 'drupalbd',
'username' =&gt; 'drupal',
'password' =&gt; 'drupal',
'prefix' =&gt; '',
'host' =&gt; '192.168.100.20',
'port' =&gt; '3306',
'namespace' =&gt; 'Drupal\\Core\\Database\\Driver\\mysql',
'driver' =&gt; 'mysql',
);
</code></pre><h3 id="instalación-de-otro-cms-php"><strong>Instalación de otro CMS PHP</strong></h3>
<p>Como segundo cms en instalacion se ha escogido moddle, por lo tanto igual que hemos hecho anteriormente con drupal comenzamos con su instalacion.</p>
<p>Instalación de moodle:</p>
<pre><code>sudo wget https://es.osdn.net/projects/sfnet_moodle/downloads/Moodle/stable38/moodle-latest-38.zip
</code></pre><p>En este caso no se ha podido descargar de la pagina oficial <a href="http://www.download.moodle.org">www.download.moodle.org</a> ya que por algún motivo a la hora de descargarse no se descargaba completa y en ese caso al intentar desempaquetar el zip que se descargaba con unzip, no se podía.</p>
<ul>
<li>Configuramos otro virtualhost y elegimos otro nombre en el mismo dominio.</li>
</ul>
<p>Una vez que tengamos la moodle en nuestro equipo empezamos a configurar el virtualhost. Copiamos el fichero drupal.conf en /etc/apache2/sites-availables y creamos un moodle.conf:</p>
<pre><code>sudo cp /etc/apache2/sites-available/drupal.conf /etc/apache2/sites-available/moodle.conf
</code></pre><p>Configuración de moodle.conf:</p>
<pre><code>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /srv/www/
    ServerName www.sergioib-drupal.org
    &lt;Directory /srv/www/moodle&gt;
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
		&lt;/Directory&gt;
</code></pre><p>Instalación de la base de datos para moodle (en el servidor de base de datos):</p>
<pre><code>vagrant@server-bd:~$ sudo mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 40
Server version: 10.3.25-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; create database moodlebd;
Query OK, 1 row affected (0.001 sec)

MariaDB [(none)]&gt; create user moodle;
Query OK, 0 rows affected (0.001 sec)

MariaDB [(none)]&gt; grant all on moodlebd.* to moodle identified by 'moodle'
    -&gt; ;
Query OK, 0 rows affected (0.001 sec)
</code></pre><p>Modificamos de permisos /srv ya que a la hora de instalar se creara un directorio moodledata en /srv y no tiene el directorio permisos de escritura  de un fichero config.php en el directorio /srv/www/moodle ya que el script de instalación no fue capaz de generarlo.</p>
<p>Contenido de config.php:</p>
<pre><code>&lt;?php  // Moodle configuration file

unset($CFG);
global $CFG;
$CFG = new stdClass();

$CFG-&gt;dbtype    = 'mysql';
$CFG-&gt;dblibrary = 'native';
$CFG-&gt;dbhost    = '192.168.100.20';
$CFG-&gt;dbname    = 'moodlebd';
$CFG-&gt;dbuser    = 'moodle';
$CFG-&gt;dbpass    = 'moodle';
$CFG-&gt;prefix    = 'mdl_';
$CFG-&gt;dboptions = array (
  'dbpersist' =&gt; 0,
  'dbport' =&gt; '',
  'dbsocket' =&gt; '',
  'dbcollation' =&gt; 'utf8mb4_general_ci',
);
$CFG-&gt;wwwroot   = 'http://www.sergioib-drupal.org/moodle';
$CFG-&gt;dataroot  = '/srv/moodledata';
$CFG-&gt;admin     = 'admin';

$CFG-&gt;directorypermissions = 0777;

require_once(__DIR__ . '/lib/setup.php');

// There is no php closing tag in this file,
// it is intentional because it prevents trailing whitespace problems!
</code></pre><p>Algunos de los fallos saltaron en la instalacion fueron los siguientes:</p>
<ul>
<li>dbtype en config.php debía ser cambiado a mariadb indicando asi el tipo de base de datos que usamos.</li>
<li>Es necesaria extensión php-intl</li>
</ul>
<p>Reiniciamos el servidor y al continuar la instalación, solo faltara poner los datos de administrador para de esa forma tener operativa la moodle.</p>
<h3 id="necesidad-de-otros-servicios"><strong>Necesidad de otros servicios</strong></h3>
<ul>
<li>La mayoría de los CMS tienen la posibilidad de mandar correos electrónicos (por ejemplo para notificar una nueva versión, notificar un comentario, etc…)</li>
</ul>
<p>Instalaremos un servidor de correo electrónico en tu servidor, por lo que debemos configurar un servidor relay de correo, para ello en el fichero /etc/postfix/main.cf, debemos poner la siguiente línea:</p>
<p>Lo primero que haremos será instalar el paquete postfix</p>
<pre><code>sudo apt install postfix
</code></pre><p>Una vez que lo instalamos, en el menú de instalación podremos configurar el correo que se usara, en este caso escogemos la opción Internet Site y despues ponemos el nombre del correo que se va a usar, en este caso sergioib-drupal.org. Ahora pasamos a introducir la siguiente linea en /etc/postfix/main.cf:</p>
<pre><code>relayhost = babuino-smtp.gonzalonazareno.org
</code></pre><p>De forma que el fichero quede de esta forma:</p>
<pre><code>smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = server.home
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = $myhostname, sergioib-drupal.org, server, localhost.localdomain, localhost
relayhost = babuino-smtp.gonzalonazareno.org
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all
</code></pre><p>Ahora solo queda configurar alguno de los CMS para que nos envíe algún correo:</p>
<ul>
<li>
<p>En el caso de drupal lo configuramos de la siguiente forma: Configurar -&gt; People -&gt; Accont -&gt; setting -&gt; Notification email addres.</p>
</li>
<li>
<p>En el caso de la moodle: Configuración -&gt; Usuarios -&gt; Cuentas -&gt; Acciones de usuario masivas</p>
</li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
